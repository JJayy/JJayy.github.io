---
layout: post
title: Day21
hide_title: False
excerpt: Boost Camp AI Tech - DAY 21
use_math: true
toc: true
toc_sticky: true
# toc_label: Category
feature-img: assets/img/feature-img/story.jpeg
author: Jay
tags: [Boost camp, AI tech, Day21]
---

# Day 21

## 학습 내용
  - [x] Graph
    - [x] 그래프를 이용한 기계학습
    - [x] 그래프 이론 개념
    - [x] 그래프 패턴

<br> 

## 개인 학습
---
### Graph
그래프는 복잡계를 효과적으로 표현하고 분석하기 위한 언어
> 그래프는 네트워크로도 불리며 정점(Vertex)과 간선으로 이루어져 있습니다. 정점은 노드(Node)라고 불리기도 하며, 간선은 엣지(Edge) 혹은 링크(Link)로도 불립니다.


> 복잡계는 구성 요소들 간의 상호작용으로 이루어지는 것으로 이 상호작용을 표현하기 위해 그래프를 사용합니다.

<br>

#### 그래프 관련 인공지능 문제
- 정점 분류(Node Classification) 문제
- 연결 예측(Link Prediction) 문제
- 추천(Recommendation) 문제
- 군집 분석(Community Detection) 문제
- 정보 전파(Information Dascading) 및 바이럴 마케팅(Viral Marketing) 문제

<br>

#### 그래프의 유형 및 분류
- 방향이 있는 그래프와 없는 그래프(Undirected Graph vs Directed Graph)
- 간선 가중치가 있는 그래프와 없는 그래프(Unweighted Graph vs Weighted Graph)
- 동종 그래프와 이종 그래프(Unpartite Graph vs Bipartite Graph)
- 실제 그래프와 랜덤 그래프
    >실제 그래프는 실제 데이터를 바탕으로 만들어진 그래프를 의미하고, 랜덤 그래프는 확률적 과정을 통해 생성한 그래프를 의미
    >랜덤 그래프의 모델로는 에르되스-레니 랜덤 그래프(Erdos-Renyi Random Graph)를 예시로 사용하겠습니다.

**에르되스-레니 랜덤 그래프** $G(n,p)$는 $n$개의 정점을 가지며, 임의의 두 개의 정점 사이에 간선이 존재할 확률을 $p$로 정의한 그래프입니다. (정점 간의 연결은 서로 독립적입니다.) 이를 통해 총 $2^{\frac{n(n-1)}{2}}$개의 그래프가 생성될 수 있으며 각 그래프가 생성될 수 있는 확률은 $p^{k}(1-p)^{\frac{n(n-1)}{2} - k}$로 나타낼 수 있습니다. (k는 간선 개수)

<br>

#### 그래프 개념 정리
**$G=(V,E)$, 여기서 $G$는 그래프(graph), $V$는 정점(vertex)들의 집합, $E$는 간선(edge)들의 집합을 나타냅니다.**   

<br>

$N(v)$ 혹은 $N_v$는 정점 $v$의 **이웃(Neighbor)** 들의 집합을 나타냅니다. 여기서 이웃은 정점 $v$와 연결된 다른 정점을 의미합니다. 특히 방향성이 있는 그래프에서는 나가는 이웃(Out-Neighbor)과 들어오는 이웃(In-Neighbor)가 존재하며 각각의 집합을 $N_{out}(v)$와 $N_{in}(v)$로 나타냅니다. 

<br>

정점 $v$에서 시작하여 $u$까지 간선으로 연결되는 정점들의 순열을 **경로(Path)** 라고 부릅니다. 경로는 $v$에서 $u$까지 간선으로 이어진 정점으로 이루어져있으므로 여러 경로가 존재할 수 있습니다. 그 중에서 최단 경로의 길이를 $v$와 $u$의 **거리(Distance)** 라고 부릅니다. 또한 정점 간 거리(Distance)의 최댓값을 그래프의 지름(Diameter)로 정의합니다.   

<br>

정점 $v$의 **연결성(Degree)** 는 그 정점과 연결된 간선의 수를 의미합니다. 즉 $v$의 이웃(neighbor)의 수와 같습니다. $d(v)$ 나 $d_v$ 혹은 $|N(v)|$로 표현합니다. 연결성 역시 방향성이 있는 그래프의 경우 나가는 연결성(Out Degree)와 들어오는 연결성(In Degree)로 나타내며, $d_{out}(v)$ 혹은 $|N_{out}(v)|$와 $d_{in}(v)$ 혹은 $|N_{in}(v)|$로 표현합니다.
> 실제 그래프에서 연결성 분포를 살펴보면 Heavy Tail 형태를 가진다는 것을 알 수 있습니다. (연결성이 높은 정점 소수와 연결성이 낮은 정점 다수) ex) 팔로우 수 혹은 구독자 수
> 이는 실제 그래프에서는 연결성이 매우 높은 허브(Hub) 정점이 존재함을 의미합니다. 
> 반면 랜덤 그래프의 연결성 분포는 높은 확률로 정규 분포와 유사합니다. 때문에 연결성이 매우 높은 허브(Hub) 정점이 존재할 가능성은 0에 가깝습니다. 

<br>

**연결 요소(Connected Component)** 는 그래프의 간선이 이어지지 않아 마치 섬처럼 그래프가 나누어진 경우를 생각하여 이해할 수 있습니다. 연결 요소는 다음 조건들을 만족합니다. (1) 연결 요소에 속하는 정점들은 경로로 연결될 수 있다. (2) (1)의 조건을 만족하면서 정점을 추가할 수 없다.    

![ConnectedComponent](/img/connectedcomponent.png)

> 실제 그래프에는 거대 연결 요소(Giant Connected Component)가 존재합니다. 이러한 거대 연결 요소는 대다수의 정점을 포합니다.
> 마찬가지로 랜덤 그래프에도 높은 확률로 거대 연결 요소가 존재합니다. (단, 정점들의 평균 연결성이 1보다 충분히 커야합니다.)

<br>

**군집(Community)** 는 다음 조건들을 만족하는 정점들의 집합입니다. (1) 집합에 속하는 정점 사이에는 많은 간선이 존재한다. (2) 집합에 속하는 정점과 그렇지 않은 정점 사이에는 적은 수의 간선이 존재한다.   
**지역적 군집 계수(Local Clustering Coefficient)** 는 한 정점에서 군집의 형성 정도를 측정합니다. 정점 $i$의 지역적 군집 계수는 정점 $i$의 이웃 쌍 중 간선으로 직접 연결된 것의 비율을 의미하며 $C_i$로 표현합니다. (단, 연결성이 0인 정점에서는 지역적 군집 계수가 정의되지 않습니다.)   
**전역 군집 계수(Global Clustering Coefficient)** 는 전체 그래프에서 군집의 형성 정도를 측정합니다. 그래프 $G$의 전역 군집 계수는 각 정점에서의 지역적 군집 계수의 평균입니다. (단, 지역적 군집 계수가 정의되지 않는 정점은 제외합니다.)   
군집 계수가 높을수록 많은 군집이 존재함을 의미합니다.   

> 실제 그래프에서는 군집 계수가 높습니다. 이는 동질성(Homophily)와 전이성(Transitivity)로 설명할 수 있습니다.   
> 반면, 랜덤 그래프에서는 지역적 혹은 전역 군집 계수가 높지 않습니다. 구체적으로 $G(n,p)$에서 군집 계수는 $p$입니다. 랜덤 그래프에서는 간선 연결을 독립적으로 생각하기에 동질성이나 전이성이 성립하지 않기 때문입니다. 

<br>

### 그래프의 표현과 저장
python에서 그래프를 표현하는 방법으로는 두 가지가 있습니다. 리스트로 표현하는 방식과 행렬로 표현하는 방식인데, 먼저 리스트로 표현하는 방식에 대해 알아보겠습니다. 
그래프를 간선들의 리스트로 저장한 **간선 리스트(Edge List)** 와 각 정점의 이웃들을 리스트로 저장한 **인접 리스트(Adjacent List)** 가 있습니다. 
> 간선 리스트: 튜플 형태 (출발점, 도착점)으로 리스트에 저장됩니다. ex) (1,2)  #1에서 2를 향하는 간선
> 인접 리스트(방향성이 없는 경우): 하나의 정점에 이웃한 정점들을 리스트로 저장합니다. ex) 1:2,5  #1에 연결된 정점 2와 5
> 인접 리스트(방향성이 있는 경우): 들어오는 이웃과 나가는 이웃들을 각각 리스트로 저장합니다. ex) IN 1:2 OUT 1:5 #1로 들어오는 이웃 2, 1에서 나가는 이웃 5

**인접 행렬(Adjacency Matrix)** 을 통해 그래프를 행렬로 표현할 수 있습니다. 
> 방향성이 없는 경우: 정점 i, j 사이에 간선이 존재하면 (i,j),(j,i)의 값이 1
> 방향성이 있는 경우: 정점 i에서 j로의 간선만 존재하면 (i,j)=1, (j,i)=0

일반적으로 행렬로 표현할 때 저장해야하는 데이터가 많아진다는 단점이 존재합니다.

<br> 

## 피어 세션
---

금일은 dacon 대회에 사용할 model의 결과의 안정성과 추후 결과를 reproduction하기 위한 seed 고정 및 모델을 통일하는 과정을 진행하였습니다. 그동안 여러 model들을 사용하면서 알게된 사용 리소스 대비 좋은 성능을 가지는 EfficientNet-b4라는 공통된 모델을 활용하여 augmentation이나 learning rate와 같은 세부 값들을 각자 튜닝하여 결과를 비교해 보기로 하였습니다. 
또한, 구글 코랩을 이용할 때 gpu 연결의 불안정성 때문에 kaggle에서 제공하는 notebook을 활용하는 방법에 대해서도 알아보았습니다.